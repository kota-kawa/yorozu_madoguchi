# 「よろず窓口（Yorozu Madoguchi）」開発記  
## 会話型AI旅行プランナーの設計思想と技術スタック、TypeScript移行のリアル

こんにちは。今回は、新しく個人開発した「よろず窓口（Yorozu Madoguchi）」というWebアプリケーションについて、開発の背景やこだわった技術スタック、そして現在進行中のリファクタリングのリアルな裏側まで、詳しく紹介します。

## 💡 「よろず窓口」とは？

「よろず窓口」は、AIアシスタントとチャット形式で対話するだけで、ユーザーにパーソナライズされた旅行プランを提案・作成してくれるWebアプリです。

単に「行き先を入力して検索ボタンを押す」ような従来のUIではなく、**「自然言語の自由なやり取りから、構造化された具体的な旅行プランを生み出す」** という会話型UX（ユーザーエクスペリエンス）にこだわって設計しました。  
ユーザーの曖昧な要望をAIエージェントが汲み取り、アクション可能な計画へ落とし込むプロダクトを目指しています。

## 🛠 採用したフルスタックアーキテクチャ

単なるプロトタイプで終わらせず、実運用や将来の拡張（スケーラビリティ）を見据えた構成にしています。各レイヤーの技術選定は以下の通りです。

- **フロントエンド: React + Vite**  
  高速な開発体験を得るためにViteを採用し、コンポーネントベースでUIを構築しています。

- **バックエンド（API）: Python（Flask）**  
  AIモデルとの連携やデータ処理の柔軟性を考慮し、PythonフレームワークのFlaskを採用しました。

- **データ基盤: PostgreSQL + Redis**  
  永続化が必要なデータはPostgreSQLで堅牢に管理し、セッションや一時的な処理の高速化にはRedisを用いてキャッシュ層を設けています。

- **AIモデル: Groq**  
  高速な推論が可能なGroq APIを組み合わせて、チャットのレスポンス遅延を極力減らし、ストレスのないUXを実現しています。

- **インフラ・環境構築: Docker Compose**  
  複数サービスをDocker Composeでオーケストレーションしています。環境変数（`.env`）による設定管理とコンテナ化により、誰でも手元で簡単に本番に近い構成を再現できるようにしました。

## 🚧 綺麗事だけじゃない！段階的なTypeScript移行のリアル

個人開発とはいえ、コードベースが大きくなるにつれてJavaScriptの動的型付けによるバグや保守性の低下が課題になってきました。  
そのため現在は、フロントエンドを段階的にTypeScriptへ移行する作業を進めています。

ここで意識しているのは、**「一気に全てを書き換えてアプリを壊さない」** という現実的なアプローチです。プロジェクトの仕様書（`spec.md`）にも、以下のルールを明記して取り組んでいます。

1. **既存の挙動を壊さないことを最優先**  
   仕様変更は行わず、純粋に型安全性の向上と保守性改善にフォーカスする。

2. **影響範囲を局所化**  
   変更単位を小さくし、移行対象外のページへ影響を広げない。必要最小限の型付けにとどめ、ページコンポーネントを徐々に `*.tsx` 化する。

3. **型定義の集約**  
   型が散らかってカオスにならないよう、フロントエンドの型定義は `frontend/src/types/` ディレクトリに一元管理する。APIレスポンスの型定義や型ガードも用意する。

APIでエラーが起きた際も、フロント側では既存のユーザー向けメッセージを維持しつつ、例外ログを正しく吐き出すという、地味ですが堅牢なエラーハンドリング方針をとっています。

## 🚀 手元で動かす方法

Docker Desktop（または Docker Engine + Compose プラグイン）が入っていれば、コマンド数回ですぐにローカル環境を立ち上げられます。

### 1. 環境変数のセットアップ

サンプルファイルから `.env` を作成し、必要なAPIキー等を設定します。

```bash
cp .env.example .env
```

### 2. コンテナのビルドと起動

フロントエンド、API、DB、Redisの全サービスが一括で立ち上がります。

```bash
docker compose up --build
```

### 3. アクセス

- フロントエンドUI: `http://localhost:5173`
- バックエンドAPI: `http://localhost:5003`

遊び終わったら、次のコマンドで綺麗に環境を停止できます。

```bash
docker compose down
```

また、バックエンドの品質担保のため、ユニットテストやカバレッジ計測（`python3 tests/run_unit_tests.py`）の仕組みも整えています。

## まとめと今後の展望

「よろず窓口」は、AIを単なる一問一答のツールとして終わらせず、実社会の「計画立案」というタスクに落とし込むUI/UXを模索したプロダクトです。

今後はTypeScript移行を完遂してフロントエンドの堅牢性を高めつつ、AIエージェントの推論ロジックをさらに洗練させていく予定です。  
少しでも興味を持っていただけたら、ぜひリポジトリを覗いてみてください。PRやIssue、フィードバックなども大歓迎です。
